<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>Amanaya – Befragung</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root { --bg:#f6f1e7; --text:#0f3a6b; --brand:#0f3a6b; }
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,sans-serif;background:var(--bg);color:var(--text);}
    .wrap{max-width:760px;margin:0 auto;padding:24px;}
    header{display:flex;align-items:center;gap:12px;margin-bottom:12px}
    header a{color:var(--brand);text-decoration:none;font-weight:700}
    h1{font-size:20px;margin:0}
    .diag{font:12px/1.3 system-ui;background:#fff; border:1px dashed #c9bfae; padding:8px 10px; border-radius:8px; margin:0 0 10px 0; color:#6b5d47;}
    .card{background:#fff;border-radius:12px;box-shadow:0 1px 6px rgba(0,0,0,.06);padding:20px}
    .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;font-size:14px;opacity:.8}
    .step h2{margin:.2rem 0 1rem}
    .options{display:grid;gap:10px;margin:.5rem 0}
    .opt{display:flex;gap:10px;align-items:flex-start;background:#f9f7f3;border:1px solid #e7e1d6;border-radius:10px;padding:10px}
    textarea,input[type="date"]{width:100%;box-sizing:border-box;padding:10px;border:1px solid #d9d1c4;border-radius:8px;background:#fff}
    .help{font-size:13px;opacity:.8}
    .nav{display:flex;gap:12px;margin-top:14px}
    button{padding:10px 14px;border-radius:10px;border:1px solid #d9d1c4;background:#fff;cursor:pointer}
    #next{background:var(--brand);color:#fff;border-color:var(--brand)}
    #progress{font-size:13px;opacity:.7}
    .notice.error{background:#fff4f4;border:1px solid #ffd6d6;color:#7a1f1f;border-radius:10px;padding:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <a href="/"><span>AMANAYA</span></a>
      <span style="opacity:.7">/ Befragung</span>
    </header>

    <!-- Diagnosezeile: zeigt, ob Script und Flow gefunden werden -->
    <div id="diag" class="diag">Lade…</div>

    <div class="card">
      <div class="topbar">
        <div id="progress">–</div>
        <div><a href="/" style="text-decoration:none">Zur Startseite</a></div>
      </div>

      <!-- Hier rendert der Runner -->
      <div id="step"></div>

      <!-- Navigation -->
      <div class="nav">
        <button id="prev" type="button">Zurück</button>
        <button id="next" type="button">Weiter</button>
      </div>
    </div>
  </div>

  <!-- Flow-URL explizit setzen + Diagnose -->
  <script>
    window.AMANAYA_FLOW_URL = "/flows/flow.de.json";
    (function(){
      const d = document.getElementById('diag');
      // schneller Netz-Check auf die JSON-Datei
      fetch(window.AMANAYA_FLOW_URL + '?ping=' + Date.now(), {cache:'no-store'})
        .then(r => r.text())
        .then(t => {
          let ok = false;
          try { const j = JSON.parse(t); ok = Array.isArray(j) || Array.isArray(j.flow); } catch(e){}
          d.textContent = ok ? 'Flow gefunden – Runner lädt…' : 'Warnung: Flow erreichbar, aber kein gültiges Array.';
        })
        .catch(() => d.textContent = 'Fehler: Flow nicht erreichbar.');
    })();
  </script>

  <!-- Runner laden: Querystring bricht Cache; onload/ onerror schreiben Diagnosen -->
  <script
    src="/js/flowrunner.js?v=runner22b"
    defer
    onload="document.getElementById('diag').textContent='Runner geladen – Rendering startet…';"
    onerror="document.getElementById('diag').textContent='Fehler: /js/flowrunner.js konnte nicht geladen werden.'">
  </script>
</body>
</html>
